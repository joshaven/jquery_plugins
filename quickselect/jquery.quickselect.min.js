function object(d){var S=function(){};S.prototype=d;return new S();}(function($){var d=function(f,g){f=$(f);var h={},k=true,l=-1,m=false,n,o,p,r=false,s,t;if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){if(Number(RegExp.$1)<=7){r=true;}}s=$('<div class="'+g.resultsClass+'" style="display:block;position:absolute"></div>').hide();t=$('<iframe />');t.css({border:'none',position:'absolute'});if(g.width>0){s.css("width",g.width);t.css("width",g.width);}$('body').append(s);if(r){$('body').append(t);}var u=function(H){return H.label||(typeof(H)==='string'?H:H[0])||'';};var v=function(H){H=$(H);if(typeof(H.data('item'))==='string'){return H.data('item');}else{return(H.data('item')?(H.data('item').label?H.data('item').label:H.data('item')[0]):'');}};var w=function(H){return H.values||(H.value?[H.value]:(typeof(H)==='string'?[H]:H))||[];};var x={quicksilver:function(q,H){q=q.toLowerCase();h[q]=[];for(var i=0;i<H.length;i++){if(u(H[i]).toLowerCase().score(q)>0){h[q].push(H[i]);}}return h[q].sort(function(a,b){a=u(a).toLowerCase().score(q);b=u(b).toLowerCase().score(q);return(a>b?-1:(b>a?1:0));});},contains:function(q,H){q=q.toLowerCase();h[q]=[];for(var i=0;i<H.length;i++){if(u(H[i]).toLowerCase().indexOf(q)>-1){h[q].push(H[i]);}}return h[q].sort(function(a,b){a=u(a).toLowerCase();b=u(b).toLowerCase();return(a.indexOf(q)>b.indexOf(q)?-1:(a.indexOf(q)<b.indexOf(q)?1:(a>b?-1:(b>a?1:0))));});},startsWith:function(q,H){q=q.toLowerCase();h[q]=[];for(var i=0;i<H.length;i++){if(u(H[i]).toLowerCase().indexOf(q)===0){h[q].push(H[i]);}}return h[q].sort(function(a,b){a=u(a).toLowerCase();b=u(b).toLowerCase();return(a>b?-1:(b>a?1:0));});}};var y={store:function(q,H){H(g.data);},ajax:function(q,H){var I=g.ajax+"?q="+encodeURI(q);for(var i in g.ajaxParams){if(g.ajaxParams.hasOwnProperty(i)){I+="\x26"+i+"\x3d"+encodeURI(g.ajaxParams[i]);}}$.getJSON(I,H);}};var z=function(H){var I=$('li',s);if(!I){return;}if(typeof(H)==="number"){l=l+H;}else{l=I.index(H);}if(l<0){l=0;}else{if(l>=I.size()){l=I.size()-1;}}I.removeClass(g.selectedClass);$(I[l]).addClass(g.selectedClass);if(g.autoFill&&this.last_keyCode!=8){f.val(o+$(I[l]).text().substring(o.length));var J=o.length,K=f.val().length,L=f.get(0);if(L.createTextRange){var M=L.createTextRange();M.collapse(true);M.moveStart("character",J);M.moveEnd("character",K);M.select();}else if(L.setSelectionRange){L.setSelectionRange(J,K);}else if(L.selectionStart){L.selectionStart=J;L.selectionEnd=K;}L.focus();}};var A=function(){if(p){clearTimeout(p);}f.removeClass(g.loadingClass);if(s.is(":visible")){s.hide();}if(t.is(":visible")){t.hide();}};var B=function(H,I){H=$(H);if(!H){H=document.createElement("li");H=$(H);H.data('item','');}var J=v(H),K=(H.data('item')?(H.data('item').values?H.data('item').values:H.data('item')||''):'');f.lastSelected=J;f.val(J);o=J;s.empty();$(g.additional_fields).each(function(i,L){$(L).val(K[i+1]);});if(!I){A();}if(g.onItemSelect){setTimeout(function(){g.onItemSelect(H);},1);}return true;};var C=function(){var H=$("li."+g.selectedClass,s).get(0);if(H){return B(H);}else{if(g.exactMatch){if(!f.val()==o){f.val('');$(g.additional_fields).each(function(i,I){$(I).val('');});}}return false;}};var D=function(H){s.empty();if(!m||H===null||H.length===0){return A();}var I=H.length,J=function(){z(this);},K=function(){},L=function(e){e.preventDefault();e.stopPropagation();B(this);};if(g.maxVisibleItems>0&&g.maxVisibleItems<I){I=g.maxVisibleItems;}s.append("<ul></ul>");var M=$('ul',s);for(var i=0;i<I;i++){M.append('<li></li>');var N=H[i],O=$('li:last',M);O.data('item',N);O.text(g.resultFormat?g.resultFormat(O.data('item'),i,I):v(O));for(var j in N.attributes){$(O).attr(j,N.attributes[j]);}$(M).append(O);O.hover(J,K).click(L);}f.removeClass(g.loadingClass);};var E=function(q,H){y[!g.data?'ajax':'store'](q,function(I){D(x[g.matchMethod](q,I));H();});};var F=function(){var H=f.offset(),I=(g.width>0?g.width:f.width()),J=$('li',s);s.css({width:parseInt(I,10)+"px",top:H.top+f.height()+5+"px",left:H.left+"px"});if(r){t.css({width:parseInt(I,10)-2+"px",top:H.top+f.height()+6+"px",left:H.left+1+"px",height:s.height()-2+'px'}).show();}s.show();if(g.autoSelectFirst||(g.selectSingleMatch&&J.length==1)){z(J.get(0));}};var G=function(){if(n>=9&&n<=45){return;}var q=f.val();if(q==o){return;}o=q;if(q.length>=g.minChars){f.addClass(g.loadingClass);E(q,F);}else{if(q.length===0&&(g.onBlank?g.onBlank():true)){$(g.additional_fields).each(function(i,H){$(H).val('');});}f.removeClass(g.loadingClass);s.hide();t.hide();}};s.mousedown(function(e){if(e.srcElement){k=e.srcElement.tagName!='DIV';}});f.keydown(function(e){n=e.keyCode;switch(e.keyCode){case 38:e.preventDefault();z(-1);break;case 40:e.preventDefault();if(!s.is(":visible")){F();z(0);}else{z(1);}break;case 13:if(C()){e.preventDefault();f.select();}break;case 9:C();break;case 27:if(l>-1&&g.exactMatch&&f.val()!=$('li',s).get(l).text()){l=-1;}$('li',s).removeClass(g.selectedClass);A();e.preventDefault();break;default:if(p){clearTimeout(p);}p=setTimeout(G,g.delay);break;}}).focus(function(){m=true;}).blur(function(e){if(k){if(l>-1){C();}m=false;if(p){clearTimeout(p);}p=setTimeout(function(){A();if(g.exactMatch&&f.val()!=f.lastSelected){B(null,true);}},200);}else{e.srcElement.focus();}});};$.fn.quickselect=function(f,g){f=f||{};f.data=(typeof(f.data)==="object"&&f.data.constructor==Array)?f.data:undefined;f.ajaxParams=f.ajaxParams||{};if(!f.delay){f.delay=(f.ajax===undefined?10:400);}f.minChars=f.minChars||1;f.cssFlavor=f.cssFlavor||'quickselect';f.inputClass=f.inputClass||f.cssFlavor+"_input";f.loadingClass=f.loadingClass||f.cssFlavor+"_loading";f.resultsClass=f.resultsClass||f.cssFlavor+"_results";f.selectedClass=f.selectedClass||f.cssFlavor+"_selected";f.matchMethod=f.matchMethod||((typeof''.score==='function')&&'\x6c'.score('\x6c')==1?'quicksilver':'contains');if(f.matchCase===undefined){f.matchCase=false;}if(f.exactMatch===undefined){f.exactMatch=false;}if(f.autoSelectFirst===undefined){f.autoSelectFirst=true;}if(f.selectSingleMatch===undefined){f.selectSingleMatch=true;}if(f.additional_fields===undefined){f.additional_fields=$('nothing');}f.maxVisibleItems=f.maxVisibleItems||-1;if(f.autoFill===undefined||f.matchMethod!='startsWith'){f.autoFill=false;}f.width=parseInt(f.width,10)||0;this.each(function(){var h=this,k=object(f);if(h.tagName=='INPUT'){d(h,k);}else if(h.tagName=='SELECT'){f.exactMatch=true;var l={};$(h.attributes).each(function(i){if(!/^(multiple|size)$/.test(this.nodeName)){l[this.nodeName]=this.nodeValue;}});var m=$("option:selected",h).get(0);k.data=[];$('option',h).each(function(i,r){var s={};$(r.attributes).each(function(i){if(!/^(disabled|label|selected|value)$/.test(this.nodeName)){s[this.nodeName]=this.nodeValue;}});k.data.push({label:$(r).text(),values:[r.value,r.value],attributes:s});});var n=$("<input type='text' />");var o=$("<input type='hidden' id='"+l.id+"' name='"+l.name+"' />");for(var p in l){n.attr(p,l[p]);}n.attr('id',n.attr('id')+'_quickselect');if(m){o.val(m.value);n.val($(m).text());}k.additional_fields=o;$(h).after(n).after(o).remove();n.quickselect(k);}});};})(jQuery);